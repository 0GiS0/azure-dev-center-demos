$schema: "1.0"
name: "Install DB Tools"
tasks:
  - name: tasks-catalog/choco
    parameters:
      package: sql-server-express
  - name: powershell
    parameters:
      command: 'Invoke-Sqlcmd -ServerInstance "localhost\SQLEXPRESS" -Query "IF NOT EXISTS(SELECT * FROM sys.server_principals WHERE name = N:''$env:USERDOMAIN\$env:USERNAME'') CREATE LOGIN [$env:USERDOMAIN\$env:USERNAME] FROM WINDOWS; ALTER SERVER ROLE [sysadmin] ADD MEMBER [$env:USERDOMAIN\$env:USERNAME];"'  
  - name: tasks-catalog/choco
    parameters:
      package: sql-server-management-studio
  - name: tasks-catalog/powershell
    parameters:
      command: "$env:Path = [System.Environment]::GetEnvironmentVariable('Path','Machine') + ';C:\\Program Files\\Microsoft VS Code\\bin'; code --install-extension ms-mssql.mssql --install-extension ms-vscode.vscode-node-azure-pack"
      runAsUser: true
  - name: tasks-catalog/attach-database
    parameters:
      source: "https://github.com/Microsoft/sql-server-samples/releases/download/adventureworks/AdventureWorksLT2022.bak"
      databaseName: "AdventureWorksLT2022"
  # - name: tasks-catalog/choco
  #   parameters:
  #     package: azure-data-studio   